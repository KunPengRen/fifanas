<!DOCTYPE html>
<html>

<head>
  <title>World Cup 2018</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link href="css/style.css" rel='stylesheet' type='text/css' />

  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="js/d3.v4.min.js"></script>
  <script type="text/javascript" src="./dist/nebulas.js"></script>
  <script type="text/javascript" src="./js/playdata.js"></script>
  <script type="text/javascript" src="./dist/nebPay.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

  <style type="text/css">
    body {
      background-image: url(images/background.jpg);
      background-repeat: repeat-y;
      background-size: 100%;
      color: white;
      height: 200%
    }

    /*li{
        
      } */

    .active a {
      border: 4px solid #F7E65E !important
    }

    #top {
      position: absolute;
      top: 0;
      left: 0px;
      height: 80px;
      width: 100%;
      /* background: blue;*/
    }

    #buttom {
      position: absolute;
      top: 80px;
      left: 0px;
      height: calc(100% - 80px);
      width: 100%;
      /*background: red;*/
    }

    #container {
      position: absolute;
      top: 0px;
      left: 5%;
      height: 100%;
      width: 90%;

      opacity: 0.8;
      z-index: 100;
      /*background: linear-gradient(#F7E65E,#89540d60);
        /*background: #F0D779;*/
      /*opacity: 0.7;*/
      /*      */
    }

    #container1 {
      position: absolute;
      top: 0px;
      left: 0;
      height: 80px;
      width: 100%;
      background: url(images/card_profile_top.png) no-repeat;
      background-size: 100%;
      float: left;

    }

    #container2 {
      position: absolute;
      top: 80px;
      left: 0;
      height: auto;
      background: url(images/card_profile.png) repeat-y;
      background-size: 100%;

      width: 100%;
      z-index: 100;
      float: left;

      /*background: red;*/
      /*top,url(images/card_profile_end.png) no-repeat bottom,*/
    }

    #guojia1 {
      height: auto;
      width: 100%;
      float: left;
    }

    #guojia2 {
      height: auto;
      width: 100%;
      float: left;
    }

    #container3 {
      position: absolute;
      width: 100%;
      float: left;
      left: 0px;
      height: 40px;
      /* background:url(images/card_profile_end.png) no-repeat bottom;*/
      background-size: 100%;

    }

    .country {
      height: 40px;
      width: 100%;
      background: red;
      float: left;
    }

    .country-detail {
      height: auto;
      width: 100%;
      float: left;
    }

    .card-items {
      width: 100%;
      height: auto;
      float: left;
    }

    .items {
      height: 200px;
      width: 110px;
      /*display:inline*/
      float: left;
      border: 1px solid #F7E65E;

    }

    .picture {
      height: 110px;
      width: 110px;
    }

    .name {
      height: 15px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .country-name {
      height: 20px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .price {
      height: 20px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .name {
      height: 20px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .button {
      height: 30px;
      width: 110px;
      cursor: pointer;
      background: url(images/pursh.png) no-repeat bottom;
      background-size: 70%;
    }

    #card-price {
      position: absolute;
      top: 200px;
      left: 0;
      height: 20px;
      width: 100%;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    #card-bottom {
      position: absolute;
      top: 230px;
      left: 0;
      height: 50px;
      width: 100%;
      background: url(images/btn.png) no-repeat bottom;
      background-size: 80%;
    }
  </style>
</head>
<script>

</script>

<body>
  <div id="top">
    <!--container-->
    <div class="container">
      <div class="top-header">
        <div class="logo">
          <a href="index.html">
            <img style="height:45px" src="images/logo.jpg" />
          </a>
        </div>
        <div class="menu">
          <ul class="nav" id="nav">
            <li class="active">
              <a href="./index.html">首页</a>
            </li>
            <li>
              <a href="./me.html">我的卡片</a>
            </li>
            <li class="active">
              <a href="./store.html">商店</a>
            </li>
          </ul>

        </div>
        <!-- <div class="clearfix"> </div> -->
      </div>
    </div>
    <!--container-->
  </div>
  <div id="buttom">
    <div id="container">
      <div id="container1">

      </div>
      <div id="container2">
        <div v-for="item in items" class="items">
          <div class="picture" v-bind:style="{ 'background-image': 'url(' + item.PlaceImgUrl + ')','background-repeat':'no-repeat','background-size':'cover' }">
          </div>
          <div class="name">
            <svg style="width: 100%;height: 100%">
              <text x="55" y="15" fill="white" text-anchor="middle">{{ item.name }}</text>
            </svg>
          </div>
          <div class="country-name">
            <svg style="width: 100%;height: 100%">
              <text x="55" y="15" fill="white" text-anchor="middle">{{ item.country }}</text>
            </svg>
          </div>
          <div class="price">
            <svg style="width: 100%;height: 100%">
              <text x="55" y="15" fill="white" text-anchor="middle">{{ item.price }}NAS</text>

            </svg>
          </div>
          <div class="button" :id="(item.id)">

          </div>
        </div>
      </div>
      <!-- <div id="card">
                <div id="card-top">
                </div>
                <div id="card-price">
                  0.173 NAS/张
                </div>
                <div id="card-bottom">
                </div>
              </div> -->
    </div>
    <div id="container3">

    </div>
  </div>
  </div>



</body>

<script type="text/javascript">

  // $('#card-bottom').click(function(){
  //   console.log('click chouka')
  // })
  var data = awsomedata;
  "use strict";
  var dappAddress = "n1qoNq95ME3P1PhMenUkQjigCQBbKA2531f";
  var nebulas = require("nebulas"), Account = Account, neb = new nebulas.Neb();
  neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"))

  var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
  var nebPay = new NebPay();
  //本地钱包地址
  var localAddress;
  var card_price;
  var items = [];
  function foreach_sale_card() {
    //
    var to = dappAddress;
    var value = "0";
    var callFunction = "foreach_sale_card";
    var callArgs = "[" + "]";

    nebPay.simulateCall(to, value, callFunction, callArgs, {
      listener: function (resp) {
        let cards = resp.result.substring(1, resp.result.length - 1).split("_")
        for (let i = 0; i < cards.length; i++) {
          console.log(cards[i].toString())
          let parts = cards[i].split("~")
          let card_id = parts[0]
          let card_data = parts[1]
          let card_price = parts[2]
          let more_data = card_data.split(",")
          let card_type = more_data[0]
          //let type_id = more_data[0]
          //let type_id = more_data[0]
          let team_id = more_data[2]
          let team_player_id = more_data[3]
          let status = more_data[4]
          var item = awsomedata[card_type]
          items.push({ 'name': item['playername'], 'PlaceImgUrl': String(item['photo']), 'country': item['teamname'], 'card_price': card_price,'id':i ,'card_id':card_id})
        }
        console.log(items);


        $(document).ready(function () {
          $('.button').click(function(d){
            num = $(this).attr("id")

           let card_id= items[num]["card_id"];
           let card_price= items[num]['card_price'];
           buy_card(card_id,card_price);
          })
        });



      }
    });
  }

  foreach_sale_card()

  console.log(items)
  var example1 = new Vue({
    el: '#container2',
    data: {
      items: items
    }
  })


  function buy_card(card_id, card_price) {
    var to = dappAddress;
    var value = String(card_price);
    var callFunction = "get_sale_card";
    var callArgs = "[\"" + card_id + "\"]";
    nebPay.call(to, value, callFunction, callArgs);

  }
  



</script>

</html>