<!DOCTYPE html>
<html>

<head>
  <title>World Cup 2018</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link href="css/style.css" rel='stylesheet' type='text/css' />
  <link href="css/intro.css" rel='stylesheet' type='text/css' />
  <script type="text/javascript" src="./js/time.js"></script>
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="js/d3.v4.min.js"></script>
  <script type="text/javascript" src="./dist/nebulas.js"></script>
  <script type="text/javascript" src="./js/playdata.js"></script>
  <script type="text/javascript" src="./dist/nebPay.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

  <style type="text/css">
    body {
      background-image: url(images/background.jpg);
      background-repeat: repeat-y;
      background-size: 100%;
      color: white;
      height: 200%
    }

    /*li{
        
      } */

    .active a {
      border: 4px solid #F7E65E !important
    }

    #top {
      position: absolute;
      top: 0;
      left: 0px;
      height: 80px;
      width: 100%;
      /* background: blue;*/
    }

    #buttom {
      position: absolute;
      top: 80px;
      left: 0px;
      height: calc(100% - 80px);
      width: 100%;
      /*background: red;*/
    }

    #container {
      position: absolute;
      top: 0px;
      left: 5%;
      height: 100%;
      width: 90%;

      opacity: 0.9;
      z-index: 100;
      /*background: linear-gradient(#F7E65E,#89540d60);
        /*background: #F0D779;*/
      /*opacity: 0.7;*/
      /*      */
    }

    #container1 {
      position: absolute;
      top: 0px;
      left: 0;
      height: 80px;
      width: 100%;
      background: url(images/card_profile_top.png) no-repeat;
      background-size: 100%;
      float: left;

    }

    #container2 {
      position: absolute;
      top: 80px;
      left: 0;
      height: auto;
      background: url(images/card_profile.png) repeat-y;
      background-size: 100%;

      width: 100%;
      z-index: 100;
      float: left;

      /*background: red;*/
      /*top,url(images/card_profile_end.png) no-repeat bottom,*/
    }

    #maincontainer{
 
        top: 0px;
        left: 20px;  
        height:auto;
       
        margin-left: 20px;
        margin-right: 20px;
    
        width: calc(100% - 40px);;

        float: left;

        /*background: red;*/
        /*top,url(images/card_profile_end.png) no-repeat bottom,*/
      }
    #guojia1 {
      height: auto;
      width: 100%;
      float: left;
    }

    #guojia2 {
      height: auto;
      width: 100%;
      float: left;
    }

    #container3 {
      position: absolute;
      width: 100%;
      float: left;
      left: 0px;
      height: 40px;
      /* background:url(images/card_profile_end.png) no-repeat bottom;*/
      background-size: 100%;

    }

    .country {
      height: 40px;
      width: 100%;
      background: red;
      float: left;
    }

    .country-detail {
      height: auto;
      width: 100%;
      float: left;
    }

    .card-items {
      width: 100%;
      height: auto;
      float: left;
    }

    .items {
      height: 200px;
      width: 110px;
      /*display:inline*/
      float: left;
      border: 1px solid grey;

    }

    .picture {
      height: 110px;
      width: 110px;
    }

    .name {
      height: 15px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .country-name {
      height: 20px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .price {
      height: 20px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .name {
      height: 20px;
      width: 110px;
      font-size: 8px;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    .button {
      height: 30px;
      width: 110px;
      cursor: pointer;
      background: url(images/pursh.png) no-repeat bottom;
      background-size: 70%;
    }

    #card-price {
      position: absolute;
      top: 200px;
      left: 0;
      height: 20px;
      width: 100%;
      text-align: center;
      /*水平居中*/
      line-height: 20px;
      /*行距设为与div高度一致*/
    }

    #card-bottom {
      position: absolute;
      top: 230px;
      left: 0;
      height: 50px;
      width: 100%;
      background: url(images/btn.png) no-repeat bottom;
      background-size: 80%;
    }
  </style>
</head>
<script>

</script>

<body>

  <div class="modal fade show" id="helpModal" tabindex="-1" role="dialog" style="display: none;">
  <div class="modal-dialog modal-lg" role="document">
  <div class="modal-content">
  <div class="modal-header">
  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
  <span aria-hidden="true">×</span>
  </button>
  </div>
  <div class="modal-body">
    <p>在PC上使用本应用需要使用Chrome浏览器安装
    <a target="_blank" href="https://github.com/ChengOrangeJu/WebExtensionWallet">WebExtensionWallet</a>插件。 手机端暂不支持，正在完善中。</p>
    <hr>
    <p><strong>游戏玩法说明：</strong></p>

    <ul>
      <li>所有玩家的球星卡片和交易都记录在区块链上，可在<a target="_blank" href="https://explorer.nebulas.io/#/tx/2be0cd63aff2e003d436f034e87dc042ddb1e68fd571ee33a8bd406480d123b7">合约详情</a>上查看。</li>
      <li>本次共选出本届世界杯八个热门球队，每个球队11位球星，每个球队选择一个超级球星为稀有卡片，可在球星图鉴中查询。</li>
      <li>玩家第一次登录系统时，免费赠送5张球星卡，每抽一张卡片消费0.05NAS，可以选择每次抽一张、五张、十张。</li>
      <li>玩家所有的卡片，都展示在我的卡片中，当集齐一个球队的所有球星时，可以发起兑换，目前兑换奖金为2nas，该奖金会随着系统售卡总金额的增加而增加。</li>
      <li>玩家可以把自己多余的卡片放到商店中出售，一旦选择出售卡片，不可以取消出售，商店卡片交易费为10%，自动从卖家收款中扣除。</li>
    </ul>
    
    <hr>
    <p><strong>星云足球说明：</strong></p>
    <ul>
      <li>所有玩家的球星卡片和交易都记录在区块链上，可在<a target="_blank" href="https://explorer.nebulas.io/#/tx/2be0cd63aff2e003d436f034e87dc042ddb1e68fd571ee33a8bd406480d123b7">合约详情</a>上查看。</li>
      <li>星云足球是在校大学生区块链兴趣小组合作开发出的第一款区块链游戏，游戏顺应当前世界杯热门。</li>
      <li>游戏初期玩法简单，玩家可以通过抽卡，然后卖卡或者兑奖收益，游戏采用基于星云链的区块链智能合约技术，保障每位玩家的数字资产的安全、可信。</li>
      <li>后期游戏玩法将会更加丰富，玩家可以将自己抽取的球星卡，组建球队，与合约上的玩家进行比赛，获胜的玩家会获取奖励。</li>
    </ul>
    <hr>
    <strong>星云足球玩家微信交流群（如果有任何疑问和建议，欢迎进群交流）：</strong>
    <img style="width: 90px; left: 50px; border:2.5px solid darkred;" src="./images/weiixn.jpg" />
    <p></p>
    </div>
  </div>
  </div>
  </div>


  <div id="top">
    <div id='timeCount'>
         
        </div>
    <!--container-->
    <div class="container">
      <div class="top-header">
        <div class="logo">
          <a href="index.html">
            <img style="height:60px" src="images/logo.png" />
          </a>
        </div>
        <div class="menu">
          <ul class="nav" id="nav">
            <li >
              <a href="./index.html">首页</a>
            </li>
            <li>
              <a href="./me.html">我的卡片</a>
            </li>
            <li class="active">
              <a href="./store.html">商店</a>
            </li>
            <li><a href="./plays.html">球星图鉴</a></li>

             <li><a class="nav-item nav-link" data-toggle="modal" id="open" data-target="#helpModal" href="javascript:;">玩法说明</a></li>
          </ul>

        </div>
        <!-- <div class="clearfix"> </div> -->
      </div>
    </div>
    <!--container-->
  </div>
  <div id="buttom">
    <div id="container">
      <div id="container1">

      </div>
      <div id="container2">
        <div id="maincontainer">
        <div v-for="item in items" class="items">
          <div class="picture" v-bind:style="{ 'background-image': 'url(' + item.PlaceImgUrl + ')','background-repeat':'no-repeat','background-size':'cover' }">
          </div>
          <div class="name">
            <svg style="width: 100%;height: 100%">
              <text x="55" y="15" fill="white" text-anchor="middle">{{ item.name }}</text>
            </svg>
          </div>
          <div class="country-name">
            <svg style="width: 100%;height: 100%">
              <text x="55" y="15" fill="white" text-anchor="middle">{{ item.country }}</text>
            </svg>
          </div>
          <div class="price">
            <svg style="width: 100%;height: 100%">
              <text x="55" y="15" fill="white" text-anchor="middle">{{ item.card_price }} NAS</text>

            </svg>
          </div>
          <div class="button" :id="(item.id)">

          </div>
        </div>
      </div>
      </div>
      <!-- <div id="card">
                <div id="card-top">
                </div>
                <div id="card-price">
                  0.173 NAS/张
                </div>
                <div id="card-bottom">
                </div>
              </div> -->
    </div>
    <div id="container3">

    </div>
  </div>
  </div>



</body>

<script type="text/javascript">
  var cardWidth = ($("#container2").width()-44)/11
  // $('#card-bottom').click(function(){
  //   console.log('click chouka')
  // })
  var data = awsomedata;
  "use strict";
  //测试网
  //var dappAddress ="n1ikVyaoedyYsVH8UiyboY9SFm51wCmoX57"
  var dappAddress = "n1zAsr4qbFEYU27m6ABcwUAtM2TwD6sXQTN";
  var nebulas = require("nebulas"), Account = Account, neb = new nebulas.Neb();
  //neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"))
  neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"))
  var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
  var nebPay = new NebPay();
  //本地钱包地址
  var localAddress;
  var card_price;
  var items = [];
  function foreach_sale_card() {
    //
    var to = dappAddress;
    var value = "0";
    var callFunction = "foreach_sale_card";
    var callArgs = "[" + "]";

    nebPay.simulateCall(to, value, callFunction, callArgs, {
      listener: function (resp) {
        let cards = resp.result.substring(1, resp.result.length - 1).split("_")
        for (let i = 0; i < cards.length; i++) {
          console.log(cards[i].toString())
          let parts = cards[i].split("~")
          let card_id = parts[0]
          let card_data = parts[1]
          let card_price = parts[2]
          let more_data = card_data.split(",")
          let card_type = more_data[0]
          //let type_id = more_data[0]
          //let type_id = more_data[0]
          let team_id = more_data[2]
          let team_player_id = more_data[3]
          let status = more_data[4]
          var item = awsomedata[card_type]
          items.push({ 'name': item['playername'], 'PlaceImgUrl': String(item['photo']), 'country': item['teamname'], 'card_price': card_price,'id':i ,'card_id':card_id})
        }
        console.log(items);


        $(document).ready(function () {
          $('.button').click(function(d){
            num = $(this).attr("id")

           let card_id= items[num]["card_id"];
           let card_price= items[num]['card_price'];
           buy_card(card_id,card_price);
          })


          $(document).ready(function () {
            $('.items').css('width', cardWidth)
            $('.items').css('height', 200+cardWidth-105)
            $('.picture').css('height', cardWidth)
            $('.picture').css('width', cardWidth)
            $('.name').css('width', cardWidth)
            $('.button').css('width', cardWidth)
            $('.picture').css('width', cardWidth)
            $('svg text').attr('x', cardWidth/2)
            $('svg > text:nth-child(1)').attr('x', cardWidth/2)
            $('svg > text:nth-child(2)').attr('x', cardWidth-5)
          });

        });



      }
    });
  }

  foreach_sale_card()

  console.log(items)
  var example1 = new Vue({
    el: '#container2',
    data: {
      items: items
    }
  })


  function buy_card(card_id, card_price) {
    var to = dappAddress;
    var value = String(card_price);
    var callFunction = "get_sale_card";
    var callArgs = "[\"" + card_id + "\"]";
    nebPay.call(to, value, callFunction, callArgs,{
      listener:function(){
        alert("正在进行区块打包交易,请耐心等待20秒后自动跳转到我的卡片页");
      setTimeout(function(){
          
          self.location="me.html";
        },20000)
      }
    });


  }
  

  $("#open").click(function(d){
    $("#helpModal").css('display', 'block')
  })
  $('.close').click(function(d){
    $("#helpModal").css('display', 'none')
  })

</script>

</html>